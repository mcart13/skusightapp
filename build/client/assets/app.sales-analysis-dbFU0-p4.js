import{r as j,j as e}from"./index-C_P7ACqV.js";import{T as s,C as u,b as c,B as T}from"./ButtonGroup-Bgv38W4W.js";import{B as b,T as F,P as L}from"./Page-DvtG3tiZ.js";import{P as C}from"./ProgressBar-DoAetvWA.js";import{D as P}from"./DataTable-DAB58wxr.js";import{S}from"./Select-CYy_g-2H.js";import{L as w}from"./List-l9Je5zTk.js";import{u as A,b as I}from"./components-CgIgXmEm.js";import{B as $}from"./Banner-4MJ0AgcI.js";import{L as k}from"./Layout-DNtBfCJd.js";import"./CSSTransition-BI2FqCs3.js";import"./index-CeTaglFb.js";import"./Sticky-q5uRhpIz.js";import"./banner-context-B9x05WVp.js";function B(t){return Array.isArray(t)?t.map(i=>{if(!i)return null;const l={...i};return i.trend>15&&(l.trendAlert={type:"acceleration",message:`Sales of ${i.title||"Unknown"} are accelerating rapidly (${i.trend}% increase). Consider restocking sooner than usual.`}),(i.title||"").includes("Snowboard")&&(l.seasonalAlert={type:"seasonal-spike",message:`${i.title||"Unknown"} typically sees a 30% increase in demand during winter season. Your current stock may run out 2 weeks earlier than predicted.`}),l}).filter(Boolean):[]}function K(t){if(!t)return[];const i=[];if(t.trend>10?i.push({factor:"Recent Sales Trend",impact:`+${Math.round(t.trend)}%`,description:`Sales are accelerating (+${Math.round(t.trend)}% in last 30 days)`}):t.trend<-10&&i.push({factor:"Recent Sales Trend",impact:`${Math.round(t.trend)}%`,description:`Sales are slowing down (${Math.round(t.trend)}% in last 30 days)`}),(t.title||"").includes("Snowboard")){const l=new Date().getMonth();(l>=9||l<=1)&&i.push({factor:"Seasonal Pattern",impact:"+30%",description:"Winter season typically increases demand by 30% based on historical data"})}return t.stdDev>2&&i.push({factor:"Sales Variability",impact:"+15%",description:"High sales variability requires higher safety stock"}),i.push({factor:"Lead Time",impact:`${t.leadTime||"Unknown"} days`,description:`Supplier typically takes ${t.leadTime||"Unknown"} days to fulfill orders`}),i}function W(t){try{const i=t.match(/\/(\d+)$/);return i?parseInt(i[1],10):0}catch{return 0}}function U(t,i){return typeof t!="number"||typeof i!="number"||i<=0?0:Math.min(100,Math.max(0,Math.round(t/i*100)))}function O(t){var i;return(i=t==null?void 0:t.products)!=null&&i.edges?t.products.edges.map(({node:l})=>{var x;const d=W(l.id),a=d%5+.5,r=(d%10+1)*.3,o=Math.round(r*30),y=(d%50+10)*5,g=d%2===0?d%25+2:-(d%15+1);let m="low";o>50?m="very-high":o>30?m="high":o>15&&(m="medium");const h=(x=l.variants.edges[0])==null?void 0:x.node,n=(h==null?void 0:h.inventoryQuantity)||0,v=r>0?Math.round(n/r):999;return{id:l.id,title:l.title,dailySales:r,monthlyVolume:o,stockLevel:n,avgUnitPrice:y,trend:g,popularityTier:m,stdDev:a,daysOfInventory:v,leadTime:7+d%14,profitMargin:30+d%20,sku:(h==null?void 0:h.sku)||`SKU-${d}`,variantId:h==null?void 0:h.id}}):[]}function V({products:t,onProductSelect:i}){const[l,d]=j.useState("trend"),[a,r]=j.useState("desc"),o=[...t].sort((n,v)=>{const x=n[l],f=v[l];if(typeof x=="number"&&typeof f=="number")return a==="desc"?f-x:x-f;const p=String(x||""),M=String(f||"");return a==="desc"?M.localeCompare(p):p.localeCompare(M)}),y=n=>{n===l?r(a==="asc"?"desc":"asc"):(d(n),r("desc"))},g=o.map(n=>[e.jsx(s,{variant:"bodyMd",fontWeight:"semibold",onClick:()=>i(n),children:n.title},`title-${n.id}`),e.jsx(s,{variant:"bodyMd",children:n.sku||"N/A"},`sku-${n.id}`),e.jsx(s,{variant:"bodyMd",alignment:"end",children:n.monthlyVolume},`monthly-${n.id}`),e.jsx("div",{children:e.jsxs(s,{variant:"bodyMd",alignment:"end",color:n.trend>0?"success":n.trend<0?"critical":"subdued",children:[n.trend>0?"+":"",n.trend,"%"]})},`trend-${n.id}`),e.jsxs("div",{children:[n.popularityTier==="very-high"&&e.jsx(b,{tone:"success",children:"Very High"}),n.popularityTier==="high"&&e.jsx(b,{tone:"success",children:"High"}),n.popularityTier==="medium"&&e.jsx(b,{tone:"attention",children:"Medium"}),n.popularityTier==="low"&&e.jsx(b,{tone:"info",children:"Low"})]},`popularity-${n.id}`),e.jsxs("div",{children:[e.jsx(s,{variant:"bodyMd",alignment:"end",children:n.stockLevel}),e.jsx(C,{progress:U(n.stockLevel,Math.max(n.stockLevel,n.monthlyVolume*2)),size:"small",tone:n.daysOfInventory<7?"critical":n.daysOfInventory<14?"warning":"success"}),e.jsxs(s,{variant:"bodySm",alignment:"end",color:"subdued",children:[n.daysOfInventory," days"]})]},`stock-${n.id}`)]),h=[{title:"Product",sortKey:"title"},{title:"SKU",sortKey:"sku"},{title:"Monthly Sales",sortKey:"monthlyVolume"},{title:"Trend",sortKey:"trend"},{title:"Popularity",sortKey:"popularityTier"},{title:"Stock Level",sortKey:"stockLevel"}].map(n=>{const v=l===n.sortKey;return e.jsx("div",{onClick:()=>y(n.sortKey),children:e.jsxs(s,{fontWeight:v?"bold":"regular",children:[n.title,v&&` ${a==="asc"?"↑":"↓"}`]})},n.sortKey)});return e.jsx(P,{columnContentTypes:["text","text","numeric","numeric","text","numeric"],headings:h,rows:g,sortable:!0,hoverable:!0})}function D({product:t,onBack:i}){const[l,d]=j.useState("30");if(!t)return null;const a=K(t),r=parseInt(l,10),o=Math.round(t.dailySales*r),y=t.stockLevel>0&&t.dailySales>0?Math.round(t.stockLevel/t.dailySales):0,g=y<t.leadTime*1.5;return e.jsx(u,{children:e.jsxs(c,{gap:"4",children:[e.jsxs(c,{gap:"1",children:[e.jsx(T,{plain:!0,onClick:i,icon:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{d:"M12 16a.997.997 0 0 1-.707-.293l-5-5a.999.999 0 0 1 0-1.414l5-5a.999.999 0 1 1 1.414 1.414L8.414 10l4.293 4.293A.999.999 0 0 1 12 16Z"})}),children:"Back to all products"}),e.jsx(s,{variant:"headingLg",fontWeight:"bold",children:t.title}),e.jsxs(s,{variant:"bodySm",color:"subdued",children:["SKU: ",t.sku||"N/A"]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(160px, 1fr))",gap:"16px"},children:[e.jsx(u,{children:e.jsxs(c,{gap:"1",children:[e.jsx(s,{variant:"headingSm",children:"Current Stock"}),e.jsx(s,{variant:"headingLg",fontWeight:"bold",children:t.stockLevel}),e.jsxs(s,{variant:"bodySm",color:y<7?"critical":y<14?"warning":"success",children:[y," days remaining"]})]})}),e.jsx(u,{children:e.jsxs(c,{gap:"1",children:[e.jsx(s,{variant:"headingSm",children:"Daily Sales"}),e.jsx(s,{variant:"headingLg",fontWeight:"bold",children:t.dailySales.toFixed(1)}),e.jsxs(s,{variant:"bodySm",color:t.trend>0?"success":t.trend<0?"critical":"subdued",children:[t.trend>0?"+":"",t.trend,"% trend"]})]})}),e.jsx(u,{children:e.jsxs(c,{gap:"1",children:[e.jsx(s,{variant:"headingSm",children:"Monthly Volume"}),e.jsx(s,{variant:"headingLg",fontWeight:"bold",children:t.monthlyVolume}),e.jsx(s,{variant:"bodySm",color:"subdued",children:"units per month"})]})}),e.jsx(u,{children:e.jsxs(c,{gap:"1",children:[e.jsx(s,{variant:"headingSm",children:"Profit Margin"}),e.jsxs(s,{variant:"headingLg",fontWeight:"bold",children:[t.profitMargin,"%"]}),e.jsxs(s,{variant:"bodySm",color:"subdued",children:["$",(t.avgUnitPrice*(t.profitMargin/100)).toFixed(2)," per unit"]})]})})]}),e.jsx(u,{children:e.jsxs(c,{gap:"4",children:[e.jsx(s,{variant:"headingMd",children:"Sales Forecast"}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-end"},children:[e.jsx("div",{children:e.jsxs(c,{gap:"1",children:[e.jsx(s,{variant:"headingSm",children:"Forecast Period"}),e.jsx(S,{value:l,onChange:d,options:[{label:"7 days",value:"7"},{label:"14 days",value:"14"},{label:"30 days",value:"30"},{label:"60 days",value:"60"},{label:"90 days",value:"90"}]})]})}),e.jsx("div",{children:e.jsxs(c,{gap:"1",children:[e.jsx(s,{variant:"headingSm",children:"Forecasted Sales"}),e.jsx(s,{variant:"headingLg",fontWeight:"bold",children:o}),e.jsxs(s,{variant:"bodySm",color:"subdued",children:["units in ",r," days"]})]})}),e.jsx("div",{children:e.jsxs(c,{gap:"1",children:[e.jsx(s,{variant:"headingSm",children:"Recommended Action"}),g?e.jsx(b,{tone:"warning",children:"Reorder Soon"}):e.jsx(b,{tone:"success",children:"Inventory Healthy"}),e.jsx(s,{variant:"bodySm",color:"subdued",children:g?`Order within ${Math.max(0,y-t.leadTime)} days`:"No action needed yet"})]})})]})]})}),e.jsx(u,{children:e.jsxs(c,{gap:"4",children:[e.jsx(s,{variant:"headingMd",children:"Forecast Explanation"}),e.jsx(w,{type:"bullet",children:a.map((m,h)=>e.jsxs(w.Item,{children:[e.jsxs(s,{fontWeight:"semibold",children:[m.factor," (",m.impact,")"]}),": ",m.description]},h))}),t.trendAlert&&e.jsx(u,{tone:"warning",children:e.jsx(s,{variant:"bodyMd",children:t.trendAlert.message})}),t.seasonalAlert&&e.jsx(u,{tone:"info",children:e.jsx(s,{variant:"bodyMd",children:t.seasonalAlert.message})})]})})]})})}function H({filters:t,onFiltersChange:i}){const l=(r,o)=>{i({...t,[r]:o})},d=(r,o)=>{i({...t,[r]:o})},a=()=>{i({searchTerm:"",trendFilter:"all",popularityFilter:"all",stockLevelFilter:"all"})};return e.jsx(u,{children:e.jsxs(c,{gap:"4",children:[e.jsx(F,{label:"Search products",value:t.searchTerm,onChange:r=>l("searchTerm",r),placeholder:"Search by product name or SKU",clearButton:!0,onClearButtonClick:()=>l("searchTerm",""),autoComplete:"off"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"16px"},children:[e.jsx(S,{label:"Trend",options:[{label:"All trends",value:"all"},{label:"Growing (>5%)",value:"growing"},{label:"Declining (<-5%)",value:"declining"},{label:"Stable (-5% to 5%)",value:"stable"}],value:t.trendFilter,onChange:r=>d("trendFilter",r)}),e.jsx(S,{label:"Popularity",options:[{label:"All popularity levels",value:"all"},{label:"Very High",value:"very-high"},{label:"High",value:"high"},{label:"Medium",value:"medium"},{label:"Low",value:"low"}],value:t.popularityFilter,onChange:r=>d("popularityFilter",r)}),e.jsx(S,{label:"Stock Level",options:[{label:"All stock levels",value:"all"},{label:"Low stock (<7 days)",value:"low"},{label:"Medium (7-30 days)",value:"medium"},{label:"High (>30 days)",value:"high"}],value:t.stockLevelFilter,onChange:r=>d("stockLevelFilter",r)})]}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(T,{onClick:a,children:"Reset Filters"})})]})})}function te(){const{salesData:t}=A(),i=I(),[l,d]=j.useState(null),[a,r]=j.useState({searchTerm:"",trendFilter:"all",popularityFilter:"all",stockLevelFilter:"all"}),o=j.useMemo(()=>{const n=O(t);return B(n)},[t]),y=j.useMemo(()=>l?o.find(n=>n.id===l):null,[l,o]),g=j.useMemo(()=>o.filter(n=>{const v=!a.searchTerm||n.title.toLowerCase().includes(a.searchTerm.toLowerCase())||n.sku&&n.sku.toLowerCase().includes(a.searchTerm.toLowerCase()),x=a.trendFilter==="all"||a.trendFilter==="growing"&&n.trend>5||a.trendFilter==="declining"&&n.trend<-5||a.trendFilter==="stable"&&n.trend>=-5&&n.trend<=5,f=a.popularityFilter==="all"||n.popularityTier===a.popularityFilter,p=a.stockLevelFilter==="all"||a.stockLevelFilter==="low"&&n.daysOfInventory<7||a.stockLevelFilter==="medium"&&n.daysOfInventory>=7&&n.daysOfInventory<=30||a.stockLevelFilter==="high"&&n.daysOfInventory>30;return v&&x&&f&&p}),[o,a]),m=n=>{d(n.id)},h=()=>{d(null)};return e.jsx(L,{title:"Sales Analysis",subtitle:"Monitor sales trends and stock levels",backAction:{content:"Back to Dashboard",onAction:()=>i("/app")},primaryAction:{content:"Customize Settings",onAction:()=>i("/app/settings")},children:e.jsx(c,{gap:"5",children:o.length===0?e.jsx($,{tone:"warning",children:e.jsx("p",{children:"No sales data available. Add products to your store to see sales analysis."})}):y?e.jsx(D,{product:y,onBack:h}):e.jsxs(e.Fragment,{children:[e.jsx(H,{filters:a,onFiltersChange:r}),e.jsx(u,{children:e.jsxs(c,{gap:"4",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(s,{variant:"headingMd",fontWeight:"semibold",children:["Products (",g.length,")"]}),a.searchTerm||a.trendFilter!=="all"||a.popularityFilter!=="all"||a.stockLevelFilter!=="all"?e.jsxs(s,{variant:"bodySm",color:"subdued",children:["Filtered from ",o.length," total products"]}):null]}),e.jsx(V,{products:g,onProductSelect:m})]})}),e.jsxs(k,{children:[e.jsx(k.Section,{children:e.jsx(u,{children:e.jsxs(c,{gap:"4",children:[e.jsx(s,{variant:"headingMd",fontWeight:"semibold",children:"Trend Summary"}),e.jsxs(c,{gap:"2",children:[e.jsxs(s,{variant:"bodyMd",children:[o.filter(n=>n.trend>5).length," products with increasing sales trends"]}),e.jsxs(s,{variant:"bodyMd",children:[o.filter(n=>n.trend<-5).length," products with decreasing sales trends"]}),e.jsxs(s,{variant:"bodyMd",children:[o.filter(n=>n.daysOfInventory<7).length," products with low inventory (less than 1 week)"]})]})]})})}),e.jsx(k.Section,{secondary:!0,children:e.jsx(u,{children:e.jsxs(c,{gap:"4",children:[e.jsx(s,{variant:"headingMd",fontWeight:"semibold",children:"Tips"}),e.jsxs(c,{gap:"2",children:[e.jsx(s,{variant:"bodyMd",children:"• Click on a product name to see detailed analysis"}),e.jsx(s,{variant:"bodyMd",children:"• Products with less than 7 days of inventory may need immediate attention"}),e.jsx(s,{variant:"bodyMd",children:"• Use the filters to focus on specific product groups"})]})]})})})]})]})})})}export{te as default};
