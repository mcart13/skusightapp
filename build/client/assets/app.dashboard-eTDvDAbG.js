import{r as S,j as t}from"./index-C_P7ACqV.js";import{g as C,s as F,a as L}from"./settings-BAS489GI.js";import{u as M,L as B}from"./components-CgIgXmEm.js";import{P as k,B as d}from"./Page-DvtG3tiZ.js";import{L as h}from"./Layout-DNtBfCJd.js";import{C as j,b as x,T as e,B as A}from"./ButtonGroup-Bgv38W4W.js";import{P}from"./ProgressBar-DoAetvWA.js";import"./CSSTransition-BI2FqCs3.js";function z(){const{products:c,error:m}=M(),[a,w]=S.useState(C());S.useEffect(()=>{let s=!0;try{const o=F(i=>{s&&w(n=>({...n,...i}))});return()=>{s=!1;try{o()}catch(i){console.error("Error unsubscribing from settings changes:",i)}}}catch(o){return console.error("Error setting up settings subscription:",o),()=>{}}},[]);const l=((c==null?void 0:c.edges)||[]).map(({node:s})=>{var o;try{const i=(o=s.variants.edges[0])==null?void 0:o.node,n=(i==null?void 0:i.inventoryQuantity)||0,v=.5+(parseInt(s.id.replace(/\D/g,""))||1)%3,u=L({inventoryQuantity:n},v),E=u.daysUntilStockout;let y="success",p="Healthy";return n===0?(y="critical",p="Out of Stock"):n<=u.criticalStockLevel?(y="critical",p="Critical Stock"):n<=u.lowStockLevel?(y="warning",p="Low Stock"):n<=u.reorderPoint&&(y="attention",p="Monitor"),{id:s.id,title:s.title,currentStock:n,avgDailySales:v,daysOfSupply:E,status:y,statusLabel:p,price:(i==null?void 0:i.price)||0,calculations:u}}catch(i){return console.error("Error processing product:",i,s),null}}).filter(Boolean);if(m&&l.length===0)return t.jsx(k,{title:"Visual Inventory Dashboard",children:t.jsx(h,{children:t.jsx(h.Section,{children:t.jsx(j,{children:t.jsxs(x,{gap:"300",children:[t.jsx(e,{as:"h2",variant:"headingMd",color:"critical",children:"Error Loading Dashboard"}),t.jsx(e,{children:m}),t.jsx(e,{children:"Please try refreshing the page or contact support if the problem persists."})]})})})})});l.sort((s,o)=>{const i={critical:3,warning:2,attention:1,success:0},n=i[s.status]||0;return(i[o.status]||0)-n});const r={critical:l.filter(s=>s.status==="critical").length,warning:l.filter(s=>s.status==="warning").length,attention:l.filter(s=>s.status==="attention").length,success:l.filter(s=>s.status==="success").length},g=l.length||1,f={critical:r.critical/g*100,warning:r.warning/g*100,attention:r.attention/g*100,success:r.success/g*100},b=l.filter(s=>s.status==="critical"||s.status==="warning");return t.jsx(k,{title:"Visual Inventory Dashboard",backAction:{content:"Main Dashboard",url:"/app"},children:t.jsxs(h,{children:[t.jsx(h.Section,{children:t.jsx(j,{children:t.jsxs(x,{gap:"500",children:[t.jsx(e,{as:"h2",variant:"headingMd",children:"Inventory Health Overview"}),t.jsxs("div",{style:{display:"flex",gap:"12px",alignItems:"center"},children:[t.jsx("div",{style:{flex:1},children:t.jsxs("div",{style:{height:"24px",display:"flex",borderRadius:"3px",overflow:"hidden"},children:[t.jsx("div",{style:{width:`${f.critical}%`,backgroundColor:"#DE3618"}}),t.jsx("div",{style:{width:`${f.warning}%`,backgroundColor:"#EEC200"}}),t.jsx("div",{style:{width:`${f.attention}%`,backgroundColor:"#9C6ADE"}}),t.jsx("div",{style:{width:`${f.success}%`,backgroundColor:"#108043"}})]})}),t.jsxs("div",{style:{display:"flex",gap:"8px"},children:[t.jsx(d,{status:"critical",children:r.critical}),t.jsx(d,{status:"warning",children:r.warning}),t.jsx(d,{status:"attention",children:r.attention}),t.jsx(d,{status:"success",children:r.success})]})]}),t.jsxs("div",{children:[t.jsxs(e,{children:[r.critical+r.warning," products need attention"]}),t.jsxs(e,{variant:"bodySm",color:"subdued",children:["Using lead time of ",a.leadTime," days and safety stock of ",a.safetyStockDays," days"]})]})]})})}),t.jsx(h.Section,{children:t.jsx(j,{children:t.jsxs(x,{gap:"500",children:[t.jsx(e,{as:"h2",variant:"headingMd",children:"Priority Actions"}),b.length>0?t.jsx(x,{gap:"400",children:b.map(s=>t.jsxs("div",{style:{padding:"12px",backgroundColor:s.status==="critical"?"#FFF4F4":"#FFFBEA",borderRadius:"4px",marginBottom:"8px"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"8px"},children:[t.jsxs("div",{children:[t.jsx(e,{variant:"headingSm",children:s.title}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginTop:"4px"},children:[t.jsx(d,{status:s.status,children:s.statusLabel}),t.jsx(e,{variant:"bodySm",children:s.daysOfSupply===0?"Currently out of stock":`${s.daysOfSupply} days of inventory left`})]})]}),t.jsx(B,{to:"/app/order-automation",children:t.jsx(A,{primary:s.status==="critical",children:s.status==="critical"?"Restock Now":"Reorder"})})]}),s.daysOfSupply>0&&t.jsxs("div",{style:{marginTop:"8px"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[t.jsx(e,{variant:"bodySm",children:"Inventory Timeline"}),t.jsxs(e,{variant:"bodySm",children:[s.daysOfSupply," days"]})]}),t.jsx(P,{progress:Math.min(100,s.daysOfSupply/Math.max(1,a.safetyStockDays+a.leadTime)*100),size:"small",color:s.status==="critical"?"critical":"warning"})]})]},s.id))}):t.jsx(e,{children:"All products have healthy inventory levels"})]})})}),t.jsx(h.Section,{children:t.jsx(j,{children:t.jsxs(x,{gap:"500",children:[t.jsx(e,{as:"h2",variant:"headingMd",children:"Inventory Timeline Visualization"}),t.jsx(x,{gap:"400",children:l.map(s=>t.jsxs("div",{style:{marginBottom:"16px"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},children:[t.jsx(e,{variant:"bodyMd",children:s.title}),t.jsx(d,{status:s.status,children:s.statusLabel})]}),t.jsxs("div",{style:{position:"relative",height:"32px",background:"#F4F6F8",borderRadius:"3px"},children:[t.jsx("div",{style:{position:"absolute",left:"25%",top:0,height:"100%",borderLeft:"1px dashed #637381",paddingLeft:"4px"},children:t.jsxs(e,{variant:"bodySm",color:"subdued",children:[Math.ceil(a.safetyStockDays*.25),"d"]})}),t.jsx("div",{style:{position:"absolute",left:"50%",top:0,height:"100%",borderLeft:"1px dashed #637381",paddingLeft:"4px"},children:t.jsxs(e,{variant:"bodySm",color:"subdued",children:[Math.ceil(a.safetyStockDays*.5),"d"]})}),t.jsx("div",{style:{position:"absolute",left:"75%",top:0,height:"100%",borderLeft:"1px dashed #637381",paddingLeft:"4px"},children:t.jsxs(e,{variant:"bodySm",color:"subdued",children:[Math.ceil(a.safetyStockDays*.75),"d"]})}),t.jsx("div",{style:{position:"absolute",left:0,top:"6px",height:"20px",width:`${Math.min(100,s.daysOfSupply/Math.max(1,a.safetyStockDays)*100)}%`,background:O(s.status),borderRadius:"2px"}}),s.daysOfSupply<a.safetyStockDays&&t.jsx("div",{style:{position:"absolute",left:`${Math.min(100,s.daysOfSupply/Math.max(1,a.safetyStockDays)*100)}%`,top:0,height:"32px",width:"2px",background:"#DE3618"}}),s.currentStock>0&&s.calculations.reorderPoint<s.currentStock&&t.jsx("div",{style:{position:"absolute",left:`${Math.min(100,s.calculations.reorderPoint/s.currentStock*100)}%`,top:0,height:"32px",width:"2px",background:"#8c6e00"}})]})]},s.id))})]})})})]})})}function O(c){if(!c)return"#AEE9AF";switch(c){case"critical":return"#FADBD7";case"warning":return"#FFEB99";case"attention":return"#E4D6FF";case"success":return"#AEE9AF";default:return"#AEE9AF"}}export{z as default};
