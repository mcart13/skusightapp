import{r as u,S as s,j as o}from"./index-C_P7ACqV.js";import{u as ye,a as ve,b as Me}from"./components-DBQK_h67.js";import{I as Ce,C as ke}from"./InlineGrid-Bd3IUeGg.js";import{M as ge,d as j,x as $,f as N,K as ie,y as se,z as je,A as Fe,D as Pe,E as Ie,v as Ne,T as x,u as Ee,B as xe,g as W,F as ce,w as De,W as Te,G as we,H as Oe,J as Ae,a as Be,P as Le,C as q,b as U}from"./Page-D9F0KSCl.js";import{L as G,T as de}from"./Layout-Dcg5LYDO.js";import{D as _e}from"./DataTable-CantQMvG.js";import{E as Re,p as He,u as Ue}from"./context-CISPVU1J.js";import{S as Qe,F as We}from"./context-Cuq_S-Fv.js";import{_ as ze,a as Ke,b as Ve,T as ue,c as qe,C as Ge}from"./CSSTransition-BI2FqCs3.js";import{S as $e,B as Ye}from"./Banner-CEqXrZgB.js";import{D as Je}from"./Divider-CYuxvDTd.js";import{L as B}from"./List-CRMF0lqa.js";import"./Sticky-BQppF5j9.js";import"./banner-context-B9x05WVp.js";var re={Backdrop:"Polaris-Backdrop",transparent:"Polaris-Backdrop--transparent",belowNavigation:"Polaris-Backdrop--belowNavigation"};function Xe(){const n=u.useContext(Qe);if(!n)throw new ge("No ScrollLockManager was provided.");return n}function Ze(n){const e=Xe();return u.useEffect(()=>(e.registerScrollLock(),()=>{e.unregisterScrollLock()}),[e]),null}function et(n){const{onClick:e,onTouchStart:a,belowNavigation:r,transparent:t,setClosing:i}=n,c=j(re.Backdrop,r&&re.belowNavigation,t&&re.transparent),m=()=>{i&&i(!0)},d=()=>{i&&i(!1),e&&e()};return s.createElement(s.Fragment,null,s.createElement(Ze,null),s.createElement("div",{className:c,onClick:d,onTouchStart:a,onMouseDown:m}))}const tt=u.createContext(void 0),nt=u.memo(function({children:e,disabled:a,root:r}){return u.useEffect(()=>{if(a||!r)return;const t=rt(r)?r.current:r;!t||t.querySelector("[autofocus]")||$(t,!1)},[a,r]),s.createElement(s.Fragment,null,e)});function rt(n){return n.current!==void 0}function at(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function oe(n,e){var a=function(i){return e&&u.isValidElement(i)?e(i):i},r=Object.create(null);return n&&u.Children.map(n,function(t){return t}).forEach(function(t){r[t.key]=a(t)}),r}function it(n,e){n=n||{},e=e||{};function a(g){return g in e?e[g]:n[g]}var r=Object.create(null),t=[];for(var i in n)i in e?t.length&&(r[i]=t,t=[]):t.push(i);var c,m={};for(var d in e){if(r[d])for(c=0;c<r[d].length;c++){var h=r[d][c];m[r[d][c]]=a(h)}m[d]=a(d)}for(c=0;c<t.length;c++)m[t[c]]=a(t[c]);return m}function w(n,e,a){return a[e]!=null?a[e]:n.props[e]}function st(n,e){return oe(n.children,function(a){return u.cloneElement(a,{onExited:e.bind(null,a),in:!0,appear:w(a,"appear",n),enter:w(a,"enter",n),exit:w(a,"exit",n)})})}function ot(n,e,a){var r=oe(n.children),t=it(e,r);return Object.keys(t).forEach(function(i){var c=t[i];if(u.isValidElement(c)){var m=i in e,d=i in r,h=e[i],g=u.isValidElement(h)&&!h.props.in;d&&(!m||g)?t[i]=u.cloneElement(c,{onExited:a.bind(null,c),in:!0,exit:w(c,"exit",n),enter:w(c,"enter",n)}):!d&&m&&!g?t[i]=u.cloneElement(c,{in:!1}):d&&m&&u.isValidElement(h)&&(t[i]=u.cloneElement(c,{onExited:a.bind(null,c),in:h.props.in,exit:w(c,"exit",n),enter:w(c,"enter",n)}))}}),t}var lt=Object.values||function(n){return Object.keys(n).map(function(e){return n[e]})},ct={component:"div",childFactory:function(e){return e}},le=function(n){ze(e,n);function e(r,t){var i;i=n.call(this,r,t)||this;var c=i.handleExited.bind(at(i));return i.state={contextValue:{isMounting:!0},handleExited:c,firstRender:!0},i}var a=e.prototype;return a.componentDidMount=function(){this.mounted=!0,this.setState({contextValue:{isMounting:!1}})},a.componentWillUnmount=function(){this.mounted=!1},e.getDerivedStateFromProps=function(t,i){var c=i.children,m=i.handleExited,d=i.firstRender;return{children:d?st(t,m):ot(t,c,m),firstRender:!1}},a.handleExited=function(t,i){var c=oe(this.props.children);t.key in c||(t.props.onExited&&t.props.onExited(i),this.mounted&&this.setState(function(m){var d=Ke({},m.children);return delete d[t.key],{children:d}}))},a.render=function(){var t=this.props,i=t.component,c=t.childFactory,m=Ve(t,["component","childFactory"]),d=this.state.contextValue,h=lt(this.state.children).map(c);return delete m.appear,delete m.enter,delete m.exit,i===null?s.createElement(ue.Provider,{value:d},h):s.createElement(ue.Provider,{value:d},s.createElement(i,m,h))},e}(s.Component);le.propTypes={};le.defaultProps=ct;var ae={Body:"Polaris-Modal__Body",NoScrollBody:"Polaris-Modal__NoScrollBody",IFrame:"Polaris-Modal__IFrame"},me={Section:"Polaris-Modal-Section",titleHidden:"Polaris-Modal-Section--titleHidden"};function be({children:n,flush:e=!1,subdued:a=!1,titleHidden:r=!1}){const t=j(me.Section,r&&me.titleHidden);return s.createElement("div",{className:t},s.createElement(N,Object.assign({as:"section",padding:e?"0":"400"},r&&{paddingInlineEnd:"0"},a&&{background:"bg-surface-tertiary"}),n))}var E={Container:"Polaris-Modal-Dialog__Container",Dialog:"Polaris-Modal-Dialog",Modal:"Polaris-Modal-Dialog__Modal",limitHeight:"Polaris-Modal-Dialog--limitHeight",sizeSmall:"Polaris-Modal-Dialog--sizeSmall",sizeLarge:"Polaris-Modal-Dialog--sizeLarge",sizeFullScreen:"Polaris-Modal-Dialog--sizeFullScreen",animateFadeUp:"Polaris-Modal-Dialog--animateFadeUp",entering:"Polaris-Modal-Dialog--entering",exiting:"Polaris-Modal-Dialog--exiting",exited:"Polaris-Modal-Dialog--exited",entered:"Polaris-Modal-Dialog--entered"};function dt({trapping:n}){const e=u.useContext(We),a=u.useId();if(!e)throw new ge("No FocusManager was provided.");const{trapFocusList:r,add:t,remove:i}=e,c=r[0]===a,m=u.useMemo(()=>({canSafelyFocus:c}),[c]);return u.useEffect(()=>{if(n)return t(a),()=>{i(a)}},[t,a,i,n]),m}function ut({trapping:n=!0,children:e}){const{canSafelyFocus:a}=dt({trapping:n}),r=u.useRef(null),[t,i]=u.useState(!0);u.useEffect(()=>{const d=a&&!(r.current&&r.current.contains(document.activeElement))?!n:!0;i(d)},[a,n]);const c=d=>{const h=r.current&&r.current.contains(document.activeElement);n===!1||!r.current||h||d.target instanceof Element&&d.target.matches(`${He.selector} *`)||a&&d.target instanceof HTMLElement&&r.current!==d.target&&!r.current.contains(d.target)&&$(r.current)},m=d=>{if(n===!1||!r.current)return;const h=je(r.current),g=Fe(r.current);d.target===g&&!d.shiftKey&&(d.preventDefault(),Pe(r.current)),d.target===h&&d.shiftKey&&(d.preventDefault(),Ie(r.current))};return s.createElement(nt,{disabled:t,root:r.current},s.createElement("div",{ref:r},s.createElement(Re,{event:"focusin",handler:c}),s.createElement(ie,{keyCode:se.Tab,keyEvent:"keydown",handler:m}),e))}function mt({instant:n,labelledBy:e,children:a,limitHeight:r,size:t,onClose:i,onExited:c,onEntered:m,setClosing:d,hasToasts:h,...g}){const L=Ue(),S=u.useRef(null),C=u.useContext(tt);let k;C&&(k=C.toastMessages);const _=j(E.Modal,t&&E[Ne("size",t)],r&&E.limitHeight),b=n?qe:pt;u.useEffect(()=>{S.current&&!S.current.contains(document.activeElement)&&$(S.current)},[]);const F=()=>{d&&d(!0)},y=()=>{d&&d(!1),i()},D=s.createElement("div",{"aria-live":"assertive"},k?k.map(P=>s.createElement(x,{visuallyHidden:!0,as:"p",key:P.id},P.content)):null);return s.createElement(b,Object.assign({},g,{nodeRef:S,mountOnEnter:!0,unmountOnExit:!0,timeout:parseInt(L.motion["motion-duration-200"],10),onEntered:m,onExited:c}),s.createElement("div",{className:E.Container,"data-polaris-layer":!0,"data-polaris-overlay":!0,ref:S},s.createElement(ut,null,s.createElement("div",{role:"dialog","aria-modal":!0,"aria-label":e,"aria-labelledby":e,tabIndex:-1,className:E.Dialog},s.createElement("div",{className:_},s.createElement(ie,{keyCode:se.Escape,keyEvent:"keydown",handler:F}),s.createElement(ie,{keyCode:se.Escape,handler:y}),a),D))))}const ft={appear:j(E.animateFadeUp,E.entering),appearActive:j(E.animateFadeUp,E.entered),enter:j(E.animateFadeUp,E.entering),enterActive:j(E.animateFadeUp,E.entered),exit:j(E.animateFadeUp,E.exiting),exitActive:j(E.animateFadeUp,E.exited)};function pt({children:n,...e}){return s.createElement(Ge,Object.assign({},e,{classNames:ft}),n)}function fe({pressed:n,onClick:e}){const a=Ee();return s.createElement(xe,{variant:"tertiary",pressed:n,icon:$e,onClick:e,accessibilityLabel:a.translate("Polaris.Common.close")})}function ht({id:n,children:e,closing:a,titleHidden:r,onClose:t}){const i="400",c="400";return r||!e?s.createElement(N,{position:"absolute",insetInlineEnd:i,insetBlockStart:c,zIndex:"1"},s.createElement(fe,{onClick:t})):s.createElement(N,{paddingBlockStart:"400",paddingBlockEnd:"400",paddingInlineStart:i,paddingInlineEnd:i,borderBlockEndWidth:"025",borderColor:"border",background:"bg-surface-tertiary"},s.createElement(Ce,{columns:{xs:"1fr auto"},gap:"400"},s.createElement(W,{gap:"400",blockAlign:"center"},s.createElement(x,{id:n,as:"h2",variant:"headingMd",breakWord:!0},e)),s.createElement(fe,{pressed:a,onClick:t})))}function gt({primaryAction:n,secondaryActions:e,children:a}){const r=n&&ce(n,{variant:"primary"})||null,t=e&&ce(e)||null,i=r||t?s.createElement(W,{gap:"200"},t,r):null;return s.createElement(W,{gap:"400",blockAlign:"center"},s.createElement(N,{borderColor:"border",borderBlockStartWidth:"025",padding:"400",width:"100%"},s.createElement(W,{gap:"400",blockAlign:"center",align:"space-between"},s.createElement(N,null,a),i)))}const pe=200,Et=400,Q=function({children:e,title:a,titleHidden:r=!1,src:t,iFrameName:i,open:c,instant:m,sectioned:d,loading:h,size:g,limitHeight:L,footer:S,primaryAction:C,secondaryActions:k,onScrolledToBottom:_,activator:b,activatorWrapper:F="div",onClose:y,onIFrameLoad:D,onTransitionEnd:P,noScroll:Y}){const[l,f]=u.useState(pe),[p,v]=u.useState(!1),z=u.useId(),O=u.useRef(null),X=Ee().translate("Polaris.Modal.iFrameTitle");let K,T;const Z=u.useCallback(()=>{P&&P()},[P]),ee=u.useCallback(()=>{f(pe);const M=b&&he(b)?b&&b.current:O.current;M&&requestAnimationFrame(()=>$(M))},[b]),te=u.useCallback(M=>{const I=M.target;if(I&&I.contentWindow)try{f(I.contentWindow.document.body.scrollHeight)}catch{f(Et)}D!=null&&D(M)},[D]);if(c){const M=!S&&!C&&!k?null:s.createElement(gt,{primaryAction:C,secondaryActions:k},S),I=d?De(e,be,{titleHidden:r}):e,A=h?s.createElement(N,{padding:"400"},s.createElement(W,{gap:"400",align:"center",blockAlign:"center"},s.createElement(Ae,null))):I,V=Y?s.createElement("div",{className:ae.NoScrollBody},s.createElement(N,{width:"100%",overflowX:"hidden",overflowY:"hidden"},A)):s.createElement(Oe,{shadow:!0,className:ae.Body,onScrolledToBottom:_},A),ne=t?s.createElement("iframe",{name:i,title:X,src:t,className:ae.IFrame,onLoad:te,style:{height:`${l}px`}}):V;K=s.createElement(mt,{instant:m,labelledBy:z,onClose:y,onEntered:Z,onExited:ee,size:g,limitHeight:L,setClosing:v},s.createElement(ht,{titleHidden:r,id:z,closing:p,onClose:y},a),ne,M),T=s.createElement(et,{setClosing:v,onClick:y})}const R=!m,H=b&&!he(b)?s.createElement(N,{ref:O,as:F},b):null;return s.createElement(Te.Provider,{value:!0},H,s.createElement(we,{idPrefix:"modal"},s.createElement(le,{appear:R,enter:R,exit:R},K),T))};function he(n){return Object.prototype.hasOwnProperty.call(n,"current")}Q.Section=be;function Tt(){const{products:n,suppliers:e}=ye(),a=ve(),r=Me(),[t,i]=u.useState([]),[c,m]=u.useState({}),[d,h]=u.useState(!1),[g,L]=u.useState(null),[S,C]=u.useState(!1),[k,_]=u.useState(!1),b={};e.forEach(l=>{b[l.id]=[]});const F=n.edges.map(({node:l})=>{var V;const f=(V=l.variants.edges[0])==null?void 0:V.node,p=(f==null?void 0:f.inventoryQuantity)||0,v=(f==null?void 0:f.sku)||"",z=(f==null?void 0:f.price)||0,O=Math.random()*3+.5,J=Math.floor(Math.random()*5)+3,X=O*.3,K=Math.ceil(1.645*X*Math.sqrt(J)),T=Math.ceil(O*J)+K,Z=O*365,ee=20,te=z*.2||5,R=Math.ceil(Math.sqrt(2*Z*ee/te)),H=p<=T,M=H?Math.max(R,T-p):0,I=e.find(ne=>ne.products.some(Se=>l.title.toLowerCase().includes(Se))),A=I?I.id:e[0].id;return H&&M>0&&b[A].push({id:l.id,title:l.title,sku:v,currentStock:p,reorderPoint:T,suggestedQuantity:M}),{id:l.id,title:l.title,sku:v,currentStock:p,reorderPoint:T,suggestedQuantity:M,needsReorder:H,supplierId:A}});u.useEffect(()=>{if(!k&&F.length>0){const l={};F.forEach(f=>{f.needsReorder&&f.suggestedQuantity>0&&(l[f.id]=f.suggestedQuantity)}),m(l),_(!0)}},[F,k]),u.useEffect(()=>{a!=null&&a.success&&!S&&C(!0)},[a,S]);const y=F.filter(l=>l.needsReorder),D=y.map(l=>{var f,p;return[o.jsx(ke,{label:"",checked:t.includes(l.id),onChange:()=>{t.includes(l.id)?i(t.filter(v=>v!==l.id)):i([...t,l.id])}}),l.title,l.sku,l.currentStock,l.reorderPoint,o.jsx(Be,{type:"number",value:((f=c[l.id])==null?void 0:f.toString())||l.suggestedQuantity.toString(),onChange:v=>{m({...c,[l.id]:parseInt(v)||0})},min:0}),((p=e.find(v=>v.id===l.supplierId))==null?void 0:p.name)||"Unknown"]}),P=l=>{const f=e.find(p=>p.id===l);L(f),h(!0)},Y=()=>{const l=y.filter(p=>t.includes(p.id)&&p.supplierId===g.id).map(p=>({id:p.id,title:p.title,sku:p.sku,quantity:c[p.id]||p.suggestedQuantity})),f=new FormData;f.append("supplierEmail",g.email),f.append("supplierName",g.name),f.append("products",JSON.stringify(l)),r(f,{method:"post"}),h(!1)};return o.jsxs(Le,{title:"Order Automation",backAction:{content:"Dashboard",url:"/app"},secondaryActions:[{content:"Select All",onAction:()=>i(y.map(l=>l.id))},{content:"Clear Selection",onAction:()=>i([])}],children:[o.jsx(G,{children:y.length===0?o.jsx(G.Section,{children:o.jsx(q,{children:o.jsxs(U,{gap:"400",children:[o.jsx(x,{as:"h2",variant:"headingMd",children:"No products currently need reordering"}),o.jsx(x,{children:"All your products have sufficient inventory based on current forecasts."})]})})}):o.jsxs(o.Fragment,{children:[o.jsx(G.Section,{children:o.jsx(q,{children:o.jsxs(U,{gap:"500",children:[o.jsx(x,{as:"h2",variant:"headingMd",children:"Products Needing Restock"}),o.jsx(_e,{columnContentTypes:["text","text","text","numeric","numeric","numeric","text"],headings:["Select","Product","SKU","Current Stock","Reorder Point","Order Quantity","Supplier"],rows:D}),o.jsx(x,{variant:"bodySm",children:"Suggested quantities are calculated based on your sales velocity, lead time, and optimal order size."})]})})}),o.jsx(G.Section,{children:o.jsx(q,{children:o.jsxs(U,{gap:"400",children:[o.jsx(x,{as:"h2",variant:"headingMd",children:"Create Purchase Orders"}),o.jsx(U,{gap:"400",children:e.map(l=>{const f=b[l.id].filter(p=>t.includes(p.id));return f.length===0?null:o.jsx(q,{children:o.jsxs(U,{gap:"400",children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[o.jsx(x,{variant:"headingSm",children:l.name}),o.jsx(xe,{primary:!0,onClick:()=>P(l.id),children:"Create Purchase Order"})]}),o.jsxs(x,{children:[f.length," products selected"]})]})},l.id)})})]})})})]})}),o.jsx(Q,{open:d,onClose:()=>h(!1),title:"Confirm Purchase Order",primaryAction:{content:"Submit Order",onAction:Y},secondaryActions:[{content:"Cancel",onAction:()=>h(!1)}],children:o.jsx(Q.Section,{children:g&&o.jsxs(de,{children:[o.jsx(x,{children:"You are about to send a purchase order to:"}),o.jsx(x,{variant:"headingMd",children:g.name}),o.jsx(x,{variant:"bodySm",children:g.email}),o.jsx(Je,{}),o.jsx(x,{variant:"headingSm",children:"Order Contents:"}),o.jsx(B,{type:"bullet",children:y.filter(l=>t.includes(l.id)&&l.supplierId===g.id).map(l=>o.jsxs(B.Item,{children:[l.title," (SKU: ",l.sku,") - Quantity: ",c[l.id]||l.suggestedQuantity]},l.id))})]})})}),o.jsx(Q,{open:S,onClose:()=>C(!1),title:"Order Submitted Successfully",primaryAction:{content:"Continue",onAction:()=>C(!1)},children:o.jsx(Q.Section,{children:a&&o.jsxs(de,{children:[o.jsxs(Ye,{status:"success",children:["Your purchase order has been sent to ",a.supplier]}),o.jsxs("div",{style:{marginTop:"12px"},children:[o.jsxs(x,{children:["Order number: ",a.orderNumber]}),o.jsxs(x,{variant:"bodySm",children:[a.products.length," products ordered"]})]}),o.jsxs("div",{style:{marginTop:"16px"},children:[o.jsx(x,{children:"In an actual implementation, this would:"}),o.jsxs(B,{type:"bullet",children:[o.jsx(B.Item,{children:"Send a formatted email to your supplier"}),o.jsx(B.Item,{children:"Update your purchase order history"}),o.jsx(B.Item,{children:"Track the order status until delivery"})]})]})]})})})]})}export{Tt as default};
