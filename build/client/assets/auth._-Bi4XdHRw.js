import{r as u,j as e}from"./index-C_P7ACqV.js";import{b as S,c as P,u as A,d as B}from"./components-CgIgXmEm.js";import{L as p}from"./Layout-DNtBfCJd.js";import{C as g,a,T as x,I as E,B as f,S as k}from"./ButtonGroup-Bgv38W4W.js";import{B as j}from"./Banner-4MJ0AgcI.js";import{L}from"./Link-BkXr7i8j.js";import{P as b}from"./ProgressBar-DoAetvWA.js";import"./banner-context-B9x05WVp.js";import"./CSSTransition-BI2FqCs3.js";function U(){const l=S(),i=P(),t=A();B();const[r,c]=u.useState({isProcessing:!0,progress:25,statusMessage:"Initializing authentication...",hasError:!1,errorMessage:"",devModeEnabled:(t==null?void 0:t.isDevMode)||!1}),m=new URLSearchParams(i.search),o=m.get("shop")||"",d=m.get("host")||"",h=u.useCallback(()=>{let s="/app";i.pathname&&i.pathname!=="/auth"&&(s=i.pathname.replace(/^\/auth/,"/app"));const n=new URLSearchParams;return o&&n.set("shop",o),d&&n.set("host",d),`${s}${n.toString()?`?${n.toString()}`:""}`},[i.pathname,o,d]);u.useEffect(()=>{if((t==null?void 0:t.status)==="authenticated"){c(v=>({...v,isProcessing:!1,progress:100,statusMessage:"Authentication successful!"}));const s=h(),n=setTimeout(()=>{l(s,{replace:!0})},500);return()=>clearTimeout(n)}if((t==null?void 0:t.status)==="error"){c(s=>({...s,isProcessing:!1,hasError:!0,progress:100,errorMessage:t.error||"Authentication failed",statusMessage:"Authentication failed"}));return}if(!o){c(s=>({...s,isProcessing:!1,hasError:!0,progress:100,errorMessage:"Shop parameter is required for authentication",statusMessage:"Missing shop parameter"}));return}c(s=>({...s,isProcessing:!0,progress:50,statusMessage:"Authenticating with Shopify..."}))},[t,l,h,o]);const M=()=>{if(!r.devModeEnabled)return null;const s=()=>{const n=h();console.warn("⚠️ Development mode: Bypassing authentication for testing"),l(n,{replace:!0})};return e.jsx(g,{children:e.jsx(g.Section,{children:e.jsxs(j,{status:"warning",title:"Development Mode",children:[e.jsx("p",{children:"Authentication bypass is available in development mode only."}),e.jsx("div",{style:{marginTop:"12px"},children:e.jsx(f,{onClick:s,children:"Continue to App (Dev Mode Only)"})})]})})})};return e.jsxs(p,{children:[e.jsx(p.Section,{children:e.jsx(g,{children:e.jsxs(a,{padding:"4",children:[e.jsx(x,{variant:"headingLg",as:"h1",children:"SkuSight Authentication"}),r.hasError?e.jsxs(a,{paddingBlock:"4",children:[e.jsx(j,{status:"critical",title:"Authentication Error",children:e.jsx("p",{children:r.errorMessage})}),e.jsx(a,{paddingBlock:"4",children:e.jsxs(E,{gap:"3",align:"center",children:[e.jsx(L,{url:"/",children:"Return to Login"}),r.devModeEnabled&&e.jsx(f,{onClick:()=>window.location.reload(),children:"Retry Authentication"})]})})]}):e.jsxs(a,{paddingBlock:"4",children:[e.jsx(x,{variant:"bodyMd",as:"p",children:r.statusMessage}),e.jsx(a,{paddingBlock:"4",children:e.jsx(b,{progress:r.progress})}),r.isProcessing&&e.jsx(a,{paddingBlock:"4",textAlign:"center",children:e.jsx(k,{size:"small"})})]})]})})}),r.devModeEnabled&&e.jsx(p.Section,{children:e.jsx(M,{})})]})}export{U as default};
