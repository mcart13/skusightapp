import{r as f,j as e}from"./index-C_P7ACqV.js";import{g as C,s as O,a as P}from"./settings-BAS489GI.js";import{u as B,L as a}from"./components-CgIgXmEm.js";import{P as L,B as R}from"./Page-DvtG3tiZ.js";import{B as $}from"./Banner-4MJ0AgcI.js";import{B as c,C as x,b as p,T as l}from"./ButtonGroup-Bgv38W4W.js";import{L as u}from"./Layout-DNtBfCJd.js";import{D as I}from"./DataTable-DAB58wxr.js";import"./banner-context-B9x05WVp.js";import"./index-CeTaglFb.js";import"./Sticky-q5uRhpIz.js";function F(){const{products:h,error:M}=B(),[g,y]=f.useState(()=>C());f.useEffect(()=>{let t=!0;try{const s=O(r=>{try{t&&y(n=>({...n,...r}))}catch(n){console.error("Error in settings update callback:",n)}});return()=>{t=!1;try{s()}catch(r){console.error("Error during unsubscribe:",r)}}}catch(s){return console.error("Error setting up settings subscription:",s),()=>{}}},[]);const S=(t,s)=>{try{const r=P({inventoryQuantity:t},s);return t<=0?"Out of stock":t<=r.criticalStockLevel?"Order now":t<=r.lowStockLevel?"Order soon":t<=r.reorderPoint?"Monitor closely":"Stock sufficient"}catch(r){return console.error("Error calculating recommendation:",r),"Calculation error"}},d=(()=>{var t,s,r;try{return((r=(s=(t=h==null?void 0:h.data)==null?void 0:t.products)==null?void 0:s.edges)==null?void 0:r.map(({node:n})=>{var j;const o=(j=n.variants.edges[0])==null?void 0:j.node,i=(o==null?void 0:o.inventoryQuantity)||0,k=parseInt(n.id.replace(/\D/g,""))||1,v=(o==null?void 0:o.sku)||`SKU-${n.title.substring(0,3).toUpperCase()}-${k.toString().padStart(3,"0")}`,m=[5,3,7,4,6],T=m.reduce((w,E)=>w+E,0)/m.length;return[n.title,i,`$${(o==null?void 0:o.price)||0}`,S(i,T),v]}))||[]}catch(n){return console.error("Error processing product data:",n),[]}})(),b=t=>{try{const s=[],r=t.filter(i=>i[1]===0);r.length>0&&s.push({title:`${r.length} products out of stock`,status:"critical",message:`The following products need immediate attention: ${r.map(i=>i[0]).join(", ")}`,actionText:"Restock Now",actionUrl:"/app/order-automation"});const n=t.filter(i=>i[3]==="Order soon"&&i[1]>0);if(n.length>0&&s.push({title:`${n.length} products need reordering soon`,status:"warning",message:`Based on current sales velocity, consider reordering: ${n.map(i=>i[0]).join(", ")}`,actionText:"View Analysis",actionUrl:"/app/sales-analysis"}),t.length>0){const i=t[0];s.push({title:`Sales trend detected for ${i[0]}`,status:"info",message:`Sales of ${i[0]} are acceleratingâ€”consider restocking sooner than initially planned. Recent data shows a 25% increase in sales velocity.`,actionText:"Review Trend",actionUrl:"/app/sales-analysis"})}const o=t.filter(i=>i[0].includes("Snowboard"));return o.length>0&&s.push({title:"Seasonal spike predicted for winter products",status:"attention",message:`Your holiday bestsellers (${o.map(i=>i[0]).join(", ")}) are predicted to run out 2 weeks earlier than usual based on historical seasonal patterns.`,actionText:"Prepare for Season",actionUrl:"/app/seasonal-planning"}),s}catch(s){return console.error("Error generating alerts:",s),[]}};return e.jsxs(L,{title:"SkuSight Inventory Predictions",primaryAction:e.jsxs("div",{style:{display:"flex",gap:"8px"},children:[e.jsx(a,{to:"/app/notifications",children:e.jsx(c,{children:"Notification Center"})}),e.jsx(a,{to:"/app/dashboard",children:e.jsx(c,{children:"Visual Dashboard"})}),e.jsx(a,{to:"/app/sales-analysis",children:e.jsx(c,{children:"View Sales Analysis"})}),e.jsx(a,{to:"/app/order-automation",children:e.jsx(c,{primary:!0,children:"Automated Ordering"})}),e.jsx(a,{to:"/app/profit-recommendations",children:e.jsx(c,{children:"Profit Maxing"})}),e.jsx(a,{to:"/app/system-status",children:e.jsx(c,{children:"System Status"})}),e.jsx(a,{to:"/app/logsview",children:e.jsx(c,{children:"Logs & Monitoring"})}),e.jsx(a,{to:"/app/settings",children:e.jsx(c,{children:"Settings"})})]}),children:[e.jsx("div",{style:{marginBottom:"16px"},children:b(d).map((t,s)=>e.jsx("div",{style:{marginBottom:"12px"},children:e.jsx($,{title:t.title,status:t.status,onDismiss:()=>{},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsx("p",{style:{marginRight:"12px"},children:t.message}),e.jsx("div",{children:e.jsx(a,{to:t.actionUrl,children:e.jsx(c,{children:t.actionText})})})]})})},s))}),e.jsxs(u,{children:[e.jsx(u.Section,{children:e.jsx(x,{children:e.jsxs(p,{gap:"400",children:[e.jsx(l,{as:"h2",variant:"headingMd",children:"Inventory Summary"}),e.jsxs(p,{gap:"200",children:[e.jsxs(l,{children:["Total Products: ",d.length]}),e.jsxs(l,{children:["Products Needing Attention: ",d.filter(t=>t[3]==="Order soon"||t[3]==="Order now").length]}),e.jsxs(l,{children:["Last Updated: ",new Date().toLocaleString()]}),e.jsxs(l,{children:["Lead Time Setting: ",g.leadTime," days | Safety Stock: ",g.safetyStockDays," days"]})]})]})})}),e.jsx(u.Section,{children:e.jsx(x,{children:e.jsxs(p,{gap:"500",children:[e.jsx(l,{as:"h2",variant:"headingMd",children:"Current Inventory Status"}),e.jsx(I,{columnContentTypes:["text","numeric","numeric","text","text"],headings:["Product","Current Stock","Price","Restock Recommendation","SKU"],rows:d})]})})}),e.jsx(u.Section,{children:e.jsx(x,{children:e.jsxs(p,{gap:"500",children:[e.jsx(l,{as:"h2",variant:"headingMd",children:"Inventory Health Overview"}),e.jsx(p,{gap:"400",children:d.map((t,s)=>{let r="success",n="Healthy";return t[1]===0?(r="critical",n="Out of Stock"):t[3]==="Order now"?(r="critical",n="Reorder Now"):t[3]==="Order soon"?(r="warning",n="Reorder Soon"):t[3]==="Monitor closely"&&(r="attention",n="Monitor"),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},children:[e.jsx(l,{variant:"bodyMd",children:t[0]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(R,{status:r,children:n}),(r==="warning"||r==="critical")&&e.jsx(a,{to:"/app/order-automation",children:e.jsx(c,{size:"slim",children:"Reorder"})})]})]},s)})})]})})})]})]})}export{F as default};
